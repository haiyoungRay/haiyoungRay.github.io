(window.webpackJsonp=window.webpackJsonp||[]).push([[89],{361:function(t,e,a){"use strict";a.r(e);var n=a(5),s=Object(n.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("ul",[a("li",[t._v("本篇介绍"),a("code",[t._v("加载时间")]),t._v("采集脚本")])]),t._v(" "),a("h2",{attrs:{id:"监控的数据结构设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#监控的数据结构设计"}},[t._v("#")]),t._v(" 监控的数据结构设计")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tkind"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'experience'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//用户体验指标")]),t._v("\n\ttype"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'timing'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//统计每个阶段的事件")]),t._v("\n\tconnectTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//TCP连接耗时")]),t._v("\n\tttfbTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//ttfb")]),t._v("\n\tresponseTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Response响应耗时")]),t._v("\n\tparseDOMTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//DOM解析渲染耗时")]),t._v("\n\tdomContentLoadedTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//DOMContentLoaded事件回调耗时")]),t._v("\n\ttimeToInteractive"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//首次可交互时间")]),t._v("\n\tloadTime"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//完整的加载时间")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"相关概念文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关概念文档"}},[t._v("#")]),t._v(" 相关概念文档")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/PerformanceTiming",target:"_blank",rel:"noopener noreferrer"}},[t._v("PerformanceTiming"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/DOMContentLoaded_event",target:"_blank",rel:"noopener noreferrer"}},[t._v("DOMContentLoaded"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://docs.google.com/document/d/1BR94tJdZLsin5poeet0XoTW60M0SjvOJQttKT-JK8HI/view#",target:"_blank",rel:"noopener noreferrer"}},[t._v("FMP"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"阶段含义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#阶段含义"}},[t._v("#")]),t._v(" 阶段含义")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("字段")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("navigationStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("初始化页面，在同一个浏览器上下文中前一个页面"),a("code",[t._v("unload")]),t._v("的时间戳，如果没有前一个页面的"),a("code",[t._v("unload")]),t._v(",则与"),a("code",[t._v("fetchStart")]),t._v("值相等")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("redirectStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("第一个"),a("code",[t._v("HTTP")]),t._v("重定向发生的时间,有跳转且是同域的重定向,否则为0")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("redirectEnd")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("最后一个重定向完成时的时间,否则为0")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("fetchStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("浏览器准备好使用"),a("code",[t._v("http")]),t._v("请求获取文档的时间,这发生在检查缓存之前")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("domainLookupStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("DNS")]),t._v("域名开始查询的时间,如果有本地的缓存或"),a("code",[t._v("keep-alive")]),t._v("则时间为0")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("domainLookupEnd")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("DNS")]),t._v("域名结束查询的时间")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("connectStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("TCP")]),t._v("开始建立连接的时间,如果是持久连接,则与"),a("code",[t._v("fetchStart")]),t._v("值相等")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("secureConnectionStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("https")]),t._v("连接开始的时间,如果不是安全连接则为0")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("connectEnd")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("TCP")]),t._v("完成握手的时间，如果是持久连接则与"),a("code",[t._v("fetchStart")]),t._v("值相等")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("requestStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("HTTP")]),t._v("请求读取真实文档开始的时间,包括从本地缓存读取")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("requestEnd")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("HTTP")]),t._v("请求读取真实文档结束的时间,包括从本地缓存读取")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("responseStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("返回浏览器从服务器收到（或从本地缓存读取）第一个字节时的"),a("code",[t._v("Unix")]),t._v("毫秒时间戳")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("responseEnd")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("返回浏览器从服务器收到（或从本地缓存读取，或从本地资源读取）最后一个字节时的"),a("code",[t._v("Unix")]),t._v("毫秒时间戳")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("unloadEventStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("前一个页面的"),a("code",[t._v("unload")]),t._v("的时间戳如果没有则为0")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("unloadEventEnd")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("与"),a("code",[t._v("unloadEventStart")]),t._v("相对应，返回的是"),a("code",[t._v("unload")]),t._v("函数执行完成的时间戳")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("domLoading")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("返回当前网页"),a("code",[t._v("DOM")]),t._v("结构开始解析时的时间戳,此时"),a("code",[t._v("document.readyState")]),t._v("变成"),a("code",[t._v("loading")]),t._v(",并将抛出"),a("code",[t._v("readyStateChange")]),t._v("事件")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("domInteractive")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("返回当前网页DOM结构结束解析、开始加载内嵌资源时时间戳,"),a("code",[t._v("document.readyState")]),t._v("变成"),a("code",[t._v("interactive")]),t._v("，并将抛出"),a("code",[t._v("readyStateChange")]),t._v("事件(注意只是"),a("code",[t._v("DOM")]),t._v("树解析完成,这时候并没有开始加载网页内的资源)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("domContentLoadedEventStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("网页"),a("code",[t._v("domContentLoaded")]),t._v("事件发生的时间")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("domContentLoadedEventEnd")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("网页"),a("code",[t._v("domContentLoaded")]),t._v("事件脚本执行完毕的时间,"),a("code",[t._v("domReady")]),t._v("的时间")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("domComplete")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("DOM")]),t._v("树解析完成,且资源也准备就绪的时间,"),a("code",[t._v("document.readyState")]),t._v("变成"),a("code",[t._v("complete")]),t._v(".并将抛出"),a("code",[t._v("readystatechange")]),t._v("事件")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("loadEventStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("load")]),t._v("事件发送给文档，也即"),a("code",[t._v("load")]),t._v("回调函数开始执行的时间")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("loadEventEnd")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("load")]),t._v("回调函数执行完成的时间")])])])]),t._v(" "),a("h2",{attrs:{id:"阶段计算"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#阶段计算"}},[t._v("#")]),t._v(" 阶段计算")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("字段")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("描述")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("计算方式")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("意义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("unload")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("前一个页面卸载耗时")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("unloadEventEnd–unloadEventStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("-")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("redirect")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("重定向耗时")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("redirectEnd–redirectStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("重定向的时间")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("appCache")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("缓存耗时")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("domainLookupStart–fetchStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("读取缓存的时间")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("dns")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("DNS解析耗时")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("domainLookupEnd–domainLookupStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("可观察域名解析服务是否正常")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("tcp")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("TCP连接耗时")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("connectEnd–connectStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("建立连接的耗时")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("ssl")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("SSL安全连接耗时")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("connectEnd–secureConnectionStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("反映数据安全连接建立耗时")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("ttfb")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("TimetoFirstByte(TTFB)网络请求耗时")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("responseStart–requestStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("TTFB是发出页面请求到接收到应答数据第一个字节所花费的毫秒数")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("response")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("响应数据传输耗时")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("responseEnd–responseStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("观察网络是否正常")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("dom")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("DOM解析耗时")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("domInteractive–responseEnd")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("观察DOM结构是否合理，是否有JS阻塞页面解析")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("dcl")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("DOMContentLoaded事件耗时")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("domContentLoadedEventEnd–domContentLoadedEventStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("当HTML文档被完全加载和解析完成之后，DOMContentLoaded事件被触发，无需等待样式表、图像和子框架的完成加载")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("resources")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("资源加载耗时")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("domComplete–domContentLoadedEventEnd")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("可观察文档流是否过大")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("domReady")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("DOM阶段渲染耗时")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("domContentLoadedEventEnd–fetchStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("DOM树和页面资源加载完成时间，会触发domContentLoaded事件")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("首次渲染耗时")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("首次渲染耗时")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("responseEnd-fetchStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("加载文档到看到第一帧非空图像的时间，也叫白屏时间")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("首次可交互时间")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("首次可交互时间")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("domInteractive-fetchStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("DOM树解析完成时间，此时document.readyState为interactive")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("首包时间耗时")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("首包时间")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("responseStart-domainLookupStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("DNS解析到响应返回给浏览器第一个字节的时间")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("页面完全加载时间")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("页面完全加载时间")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("loadEventStart-fetchStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("-")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("onLoad")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("onLoad事件耗时")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("loadEventEnd–loadEventStart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("-")])])])]),t._v(" "),a("ul",[a("li",[t._v("我们用两张图看一下浏览器渲染页面的原理\n"),a("monitor-test16"),t._v(" "),a("monitor-test17")],1)]),t._v(" "),a("h2",{attrs:{id:"实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[t._v("#")]),t._v(" 实现")]),t._v(" "),a("h3",{attrs:{id:"index-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#index-js"}},[t._v("#")]),t._v(" index.js")]),t._v(" "),a("p",[t._v("src\\monitor\\index.js")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" injectJsError "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./lib/js-error"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" injectXHR "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./lib/xhr"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" blankSreen "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./lib/blank-screen"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" timing "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./lib/timing"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("injectJsError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("injectXHR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("blankSreen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("timing")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"timing-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#timing-js"}},[t._v("#")]),t._v(" timing.js")]),t._v(" "),a("p",[t._v("src\\monitor\\lib\\timing.js")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" tracker "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../utils/tracker'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" onload "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../utils/onload'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("timing")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onload")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        fetchStart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//开始获取文档")]),t._v("\n        connectStart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//开始连接")]),t._v("\n        connectEnd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//结束连接")]),t._v("\n        requestStart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//开始请求")]),t._v("\n        responseStart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//响应开始")]),t._v("\n        responseEnd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//结束结束")]),t._v("\n        domLoading"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//开始解析DOM")]),t._v("\n        domInteractive"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//DOM结构结束解析")]),t._v("\n        domContentLoadedEventStart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//DOMContentLoaded事件开始")]),t._v("\n        domContentLoadedEventEnd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//DOMContentLoaded事件结束")]),t._v("\n        loadEventStart "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//开始load回调函数")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" performance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("timing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//加载时间监控")]),t._v("\n      tracker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        kind"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'experience'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//用户体验指标")]),t._v("\n        type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'timing'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//统计每个阶段的事件")]),t._v("\n        connectTime"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" connectEnd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" connectStart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//TCP连接耗时")]),t._v("\n        ttfbTime"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" responseStart "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" requestStart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//ttfb")]),t._v("\n        responseTime"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" responseEnd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" responseStart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Response响应耗时")]),t._v("\n        parseDOMTime"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" loadEventStart "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" domLoading"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//DOM解析渲染耗时")]),t._v("\n        domContentLoadedTime"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" domContentLoadedEventEnd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" domContentLoadedEventStart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//DOMContentLoaded事件回调耗时")]),t._v("\n        timeToInteractive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" domInteractive "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" fetchStart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//首次可交互时间")]),t._v("\n        loadTime"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" loadEventStart "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" fetchStart "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//完整的加载时间")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"期望"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#期望"}},[t._v("#")]),t._v(" 期望")]),t._v(" "),a("ul",[a("li",[t._v("数据\n"),a("monitor-test18")],1),t._v(" "),a("li",[t._v("同时我们将异常发送至服务端\n"),a("monitor-test19")],1)])])}),[],!1,null,null,null);e.default=s.exports}}]);